<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Accueil</ion-title>
    <ion-buttons slot="end">
      @if (notificationCount > 0) {
        <ion-badge color="danger">{{ notificationCount }}</ion-badge>
      }
      <ion-button (click)="openNotifications()">
        <ion-icon name="notifications-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar color="primary">
    <ion-title size="small">Prenez rendez-vous avec les meilleurs médecins</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" id="main-content">
  @if (isLoading) {
    <ion-spinner name="crescent" class="loading-spinner"></ion-spinner>
  }

  @if (!isLoading) {
    @if (!isLoggedIn) {
      <div class="auth-section">
        <ion-button expand="full" color="primary" (click)="goToLogin()">
          <ion-icon name="log-in-outline" slot="start"></ion-icon>
          Connexion
        </ion-button>
        <ion-button expand="full" color="secondary" (click)="openRegisterModal()">
          <ion-icon name="person-add-outline" slot="start"></ion-icon>
          Inscription
        </ion-button>
      </div>
    }

    <div class="search-container">
      <ion-item class="search-bar">
        <ion-icon name="search-outline" slot="start"></ion-icon>
        <ion-input
          type="text"
          [(ngModel)]="searchQuery"
          (ionInput)="onSearch($event)"
          placeholder="Médecin ou spécialité..."
          debounce="300"
        ></ion-input>
      </ion-item>
      <ion-button expand="full" color="primary" (click)="onSearch()">
        <ion-icon name="search-outline" slot="start"></ion-icon>
        Rechercher
      </ion-button>
    </div>

    <div class="filters-section">
      <ion-item>
        <ion-label>Filtrer par ville</ion-label>
        <ion-select [(ngModel)]="selectedCity" (ionChange)="onFilterChange()">
          <ion-select-option value="">Toutes</ion-select-option>
          @for (city of cities; track city) {
            <ion-select-option [value]="city">{{ city }}</ion-select-option>
          }
        </ion-select>
      </ion-item>
    </div>

    <div class="specialties-section">
      <h2>Spécialités populaires</h2>
      <ion-grid>
        <ion-row>
          @for (specialty of popularSpecialties; track specialty.name) {
            <ion-col size="6" class="specialty-col">
              <ion-card (click)="onSpecialtySelected(specialty)" class="specialty-card">
                <ion-card-header>
                  <ion-icon [name]="specialty.icon" class="specialty-icon"></ion-icon>
                  <ion-card-title>{{ specialty.name }}</ion-card-title>
                </ion-card-header>
              </ion-card>
            </ion-col>
          }
        </ion-row>
      </ion-grid>
    </div>

    <div class="doctors-section">
      <h2>Médecins disponibles</h2>
      @if (errorMessage) {
        <ion-text color="danger">{{ errorMessage }}</ion-text>
      }
      <ion-list>
        @for (doctor of doctors; track doctor._id) {
          <ion-item class="doctor-card">
            <ion-avatar slot="start">
              <img [src]="doctor.photo || 'assets/default-doctor.jpg'" alt="{{ doctor.name }}">
            </ion-avatar>
            <ion-label>
              <h3>{{ doctor.name }}</h3>
              <p>{{ doctor.specialty }}</p>
              <p><ion-icon name="star" color="warning"></ion-icon> {{ doctor.rating || 'N/A' }}</p>
            </ion-label>
            <ion-button fill="clear" color="primary" (click)="toggleFavorite(doctor)">
              <ion-icon [name]="doctor.isFavorite ? 'heart' : 'heart-outline'"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="primary" (click)="bookAppointment(doctor)">
              RDV
            </ion-button>
            <ion-button fill="clear" color="medium" (click)="viewDoctorDetails(doctor)">
              Détails
            </ion-button>
          </ion-item>
        }
      </ion-list>
    </div>
  }
</ion-content>

<ion-footer>
  <ion-toolbar color="light">
    <ion-grid>
      <ion-row>
        <ion-col size="4">
          <ion-button expand="block" fill="clear" color="medium" (click)="goToProfile()">
            <ion-icon name="person-outline" size="large"></ion-icon>
            <ion-label>Profil</ion-label>
          </ion-button>
        </ion-col>
        <ion-col size="4">
          <ion-button expand="block" fill="clear" color="medium" (click)="goToAppointments()">
            <ion-icon name="calendar-outline" size="large"></ion-icon>
            <ion-label>Rendez-vous</ion-label>
          </ion-button>
        </ion-col>
        <ion-col size="4">
          <ion-button expand="block" fill="clear" color="medium" (click)="goToMessaging()">
            <ion-icon name="chatbubbles-outline" size="large"></ion-icon>
            <ion-label>Messages</ion-label>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>